<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$TITLE$</title>
    <link href="$CSS_URL$" rel="stylesheet" type="text/css" media="all">
    <!--<link href="iframed.css" rel="stylesheet" type="text/css" media="all">-->
    <style>
    </style>
</head>
<body>

<div class="screenshot">
</div>

<div class="overlay">
    <div class="title">
        <a href="$LINK_URL$">$TITLE$</a>
    </div>
    <div class="link">
        <a href="$LINK_URL$">$LINK_TEXT$</a>
    </div>
</div>

<iframe src="$IFRAME_URL$" frameborder="0" style="display: none;"></iframe>

<script>
    document.body.dataset.devicePixelRatio = '' + window.devicePixelRatio;

    // console.log("chrome", chrome);
    // console.log("chrome.runtime", chrome.runtime);
    //const msg = {message: 'IFRAMED_STARTED'};
    //chrome.runtime.sendMessage('mmmjhcioolknafdgaeoffcmbfkhccbao', msg, function (response) {
    //    console.log("response", response);
    //});

    // todo maybe remove listeners unused anymore

    // console.log("chrome", typeof chrome);
    const $frame = document.querySelector('iframe');
    window.addEventListener('message', function (messageEvent) {
        if (messageEvent.data.call === 'helloFromFrame') {
            const dataUri = messageEvent.data.dataUri;
            // console.log("parent received dataUri", dataUri);
            document.querySelector('.screenshot').style.backgroundImage = 'url(' + dataUri + ')';
            $frame.parentNode.removeChild($frame);
        }
    });
    $frame.addEventListener("load", function () {
        // pass the original url to the frame, so we can redirect user to it onlick
        const url = document.querySelector('.link a').href;
        $frame.contentWindow.postMessage({call: 'setFrameParams', url: url}, '*');
    });
</script>

</html>
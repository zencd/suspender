<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$TITLE$</title>
    <link href="$CSS_URL$" rel="stylesheet" type="text/css" media="all">
</head>
<body>

<div class="screenshot">
</div>

<div class="overlay">
    <div class="title">
        <a href="$LINK_URL$">$TITLE$</a>
    </div>
    <div class="link">
        <a href="$LINK_URL$">$LINK_TEXT$</a>
    </div>
</div>

<iframe src="$IFRAME_URL$" frameborder="0" style="display: none;"></iframe>

<script id="main-script">
    document.body.dataset.devicePixelRatio = '' + window.devicePixelRatio;

    const $frame = document.querySelector('iframe');

    const messageListener = window.addEventListener('message', function (messageEvent) {
        if (typeof messageEvent.data === 'object' && messageEvent.data.call === 'setScreenshot') {
            const dataUri = messageEvent.data.dataUri;
            document.querySelector('.screenshot').style.backgroundImage = 'url(' + dataUri + ')';
            $frame.remove();
            document.querySelector('#main-script').remove();
            window.removeEventListener('message', messageListener);
        }
    });

    const loadListener = $frame.addEventListener("load", function () {
        // pass the original url to the frame, so we can redirect user to it onlick
        const url = document.querySelector('.link a').href;
        $frame.contentWindow.postMessage({call: 'setFrameParams', url: url, tabId: $TAB_ID$}, '*');
        $frame.removeEventListener("load", loadListener);
    });
</script>

</html>
